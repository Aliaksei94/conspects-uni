\section{Systems with inputs and outputs}

Study/control systems $\dot{x} = f(x,u)$ with "output" $y(t)=W(x(t))$

\subsection{Sliding mode control}

Motivating example
\begin{equation*}
\dot{x_1} = x_2
\end{equation*}
\begin{equation*}
\dot{x_2} = u \Rightarrow \dot{y} = x_2 + u
\end{equation*}
\begin{equation*}
y = x_1 + x_2
\end{equation*}

Choose:
\begin{equation*}
u =  \left\{
                \begin{array}{ll}
                  -x_2-1, \ \ y > 0\\
                  -x_2+1, \ \ y < 0\\
                  -x_2, \ \ y=0
                \end{array}
              \right. 
\end{equation*}
\begin{equation*}
\Rightarrow \dot y =  \left\{
                \begin{array}{ll}
                  -1, \ \ y > 0\\
                  +1, \ \ y < 0\\
                  0, \ \ y=0
                \end{array}
              \right. 
\end{equation*}

Solutions(Laratheodory) are if $y(0) > 0$, then 
\begin{equation*}
y(t) = \left\{ \begin{array}{ll}
                  y(0) - t, \ \ t \leq y(0)\\
                  0, \ \ t > y(0)
                \end{array}
              \right. 
\end{equation*}
If $y(0) < 0$, then
\begin{equation*}
y(t) = \left\{ \begin{array}{ll}
                  y(0) + t, \ \ t \leq y(0)\\
                  0, \ \ t > -y(0)
                \end{array}
              \right. 
\end{equation*}

%TODO picture

Key property: choose $u$ s.t. $y(t)$ goes to zero in finite time $\Rightarrow x(t)$ tends $\{ (x_1, x_2) \in \mathbb{R}^2 | x_1 +x_2 = 0 \}$ in finite time

Consider dynamics on $S$
\begin{equation*}
\left\{ \begin{array}{l}
                  \dot{x_1} = x_2 (x_2 = -x_1 \ $if$ \  y =1) = -x_1\\
                 \dot{x_2} = u = -x_2
                \end{array}
              \right. 
\end{equation*} 
globally as stable

%TODO picture

Two "phases"
\begin{enumerate}
\item solutions converge to $S$ in finite time
\item solutions converge to zero ("on S") asymptotically
\end{enumerate}
$\leadsto $ "sliding mode" control

Remark: in (1) "finite time convergence is crucial"

General procedure:
\begin{equation*}
\dot{x} = f(x)+g(x)u \\
y = h(x)= s(x)
\end{equation*}
$f: \mathbb{R}^n \to \mathbb{R}^n, \  y : \mathbb{R}^n \to \mathbb{R}^n, \ s: \mathbb{R}^n \to \mathbb{R}$

$u$ - scalar input, $s(x)$ - sliding

single input, single output 

Assumptions: $y$ has relative degree 1, well - defined globally, i.e. $L_gs(x) \neq 0 \ \forall \in \mathbb{R}^n$

Two-step approach:
\begin{enumerate}
\item Bring $x(t)$ to $S := \left \{ x \in \mathbb{R}^n | S(x) = 0 \right\}$ in finite time
\item Have $x(t)$ going to zero asymptotically (on $S$)
\begin{itemize}
\item switching between nodes 1 and 2
\item mode 2 is "sliding mode"
\end{itemize}
\end{enumerate} 

%TODO picture

How are 1 + 2 achieved?
\begin{itemize}
\item Design of sliding manifolds crucial!

Need: For $y(t)=0$ for all $t \geq 0$. All solutions convergeto the origin, i.e., "zero dynamics" have globally asymptotically stable origin.

How? e.g. systems in "regular form"
$x = \left[ \eta \xi \right]'$ 
\begin{equation*}
\begin{array}{l}
     \dot{\eta} = f_1(\eta, \xi)\\
     \dot{\xi} = f_2(\eta, \xi) + g_2(\eta,\xi) u
\end{array}
\end{equation*}
Choose $s(x)=\eta - \phi(\eta)$, where $\phi$ asymptotically stabilizes zero dynamics $\dot{\eta} = f_1(\eta, \phi(\eta))$ (and $\phi(0) = 0$)
Ex. 1.9 in Khalil
\item Converging to sliding manifold in finite time:
$\leadsto \dot{y} = L_fs(x) + L_gs(x)u$, where $L_gs(x) \neq 0$. Obvious choice to render $S$ invariant is $u = - \frac{L_fS(x)}{L_gs(x)}$ (mode 2, behaviour on $S$)

Asin motivating example, add 
\begin{equation*}
\left \{ \begin{array}{ll}
     - \hat{u}/ L_gs(x) & y > 0 \\
     \hat{u} /L_gs(x) & y < 0
\end{array} \right.
\end{equation*}
where $\hat{u} > 0$

\begin{equation*}
 u = - \frac{1}{L_gs(x)}(L_fs(x) + \hat{u}sgn(s(x)))
\end{equation*}
$\leadsto \dot{y} = - \hat{u} sgn(y)$

$\leadsto $ (caratheodory) solutions converge to zero in finite time

$\leadsto x(t)$ converges to $S$ in finite time
\end{itemize}

Control Lyapunov perspective

$V(X) = \frac{1}{2}s(x)^2$
\begin{equation*}
\dot{V}(x) = s(x) \dot{s}(x) = s(x)(L_fs(x)+L_gs(x)u) = -s(x)sgn(s(x))\hat{u} = | s(x)|\hat{u} < 0 for s(x) \neq 0
\end{equation*}

Consider $W = \sqrt{2v} \leadsto^{s \neq 0} \dot{w} = \sqrt{2}, \ \frac{1}{2\sqrt{v}}\dot{v}=-\hat{u}$

$\leadsto w$ converges to 0 in finite time $\Rightarrow V $ converges to 0 in finite time $\Rightarrow S(x(t))$ converges to 0 in finite time.

\begin{Example}
\begin{equation}
\begin{array}{l}
     \dot{x_1} = x_2 + x_1 sin(x_2)\\
     \dot{x_2} = x_2^2 + x_1 + u
\end{array}
\end{equation}
Choose $s(x) = x_2 + 2x_1$, where $+2x_! := \phi(x_1)$ on $S$: $\dot{x_1} = -2x_1 + x_1 sin(-2x_1) \leadsto $ asymptotically stable
\begin{equation*}
\dot{s} = x_2^2 + x_1 + u - 2x_2 -2x_1 sin(x_2) \leadsto u = - (x_2^2 + x_1 -2x_2 -2x_1sin(x_2) + \hat{u}sgn(x_2 -2x_1)), \ \hat{u} > 0
\end{equation*} 
$\leadsto$ yields finite-time convergence to $S$.
\end{Example}

Alternative sliding mode controllers
\begin{equation*}
u = - \frac{1}{L_gs(x)}(L_fs(x) + \hat{u}sgn(s(x))), \ \hat{u} > 0
\end{equation*}

In particular
\begin{equation*}
u = - \frac{1}{L_gs(x)}(L_fs(x) + \hat{u}|L_gs(x)|sgn(s(x)))
\end{equation*}
$\leadsto $ ensure robustness w.r.t. "matched uncertainties"
\begin{equation*}
\dot{x} = f(x) + g(x) \sigma (x) + g(x)u 
\end{equation*}
$\sigma : \mathbb{R}^n \to \mathbb{R}$, bounded (i.e., $|\sigma (x)| \leq c \ \forall x \in \mathbb{R}^n $)

Why? $V(x) = \frac{1}{2}s(x)^2$
\begin{equation*}
\dot{V} = s(x)(L_fs(x) + L_gs(x)u + L_gs(x)\sigma (x)) = - s(x)sgn(s(x)) \hat{u} |L_gs(x)| + s(x)L_gs(x)\sigma (x) \leq - |s(x)| |L_gs(x)| (\hat{u} - c)
\end{equation*}
\begin{equation*}
u = - \frac{1}{L_gs(x)}(L_fs(x) + (\hat{u} + \beta (x) |L_gs(x)|) sgn(s(x)))
\end{equation*}
ensures robustness w.r.t. matched uncertainties s.t. $\sigma (x) \leq \beta (x) \ \forall x\in \mathbb{R}^n$

Example 2
\begin{Example}
\begin{equation*}
\begin{array}{l}
     \dot{x_1} = x_2 + x_1 sin(x_2)\\
     \dot{x_2} = \theta x_2^2 + x_1 + u
\end{array}
\end{equation*}

$|\theta| \leq 2 \leadsto |\theta x_2^2| \leq 2x_2^2 = \beta(x)$

\begin{equation*}
\dot{s} = \theta x_2^2 + x_1 +u +2x_1 +2x_1sinx_2
\end{equation*}
\begin{equation*}
u = -(x_1 +2x_1 +2x_1sinx_2 + \hat{u}sign(s(x)) + 2x_2^2sgn(s(x)))
\end{equation*}
$L_fs(x) = x_1 +2x_1 +2x_1sinx_2$

$\leadsto \dot{s} = - \hat{u}sgn(s(x)) + x_2^2(\theta - 2sgn(s(x))) \Rightarrow$ finite -time convergence to $S$.
\end{Example}

%TODO picture

Remedy: replace sign-function by saturated slope (continuous approximation)

can be extended to multi-input systems $u \in \mathbb{R}^m \to s: \mathbb{R}^n \to \mathbb{R}^m$

\subsection{Dissipativity}

%TODO picture

Dissipativity: Generalization of Lyapunov theory to systems $w$ inputs and outputs

\begin{equation}\label{input-output}
\begin{array}{lll}
     \dot{x} = f(x,u) & x(0) = x_0 & f: \mathbb{R}^n \times \mathbb{R}^m \to \mathbb{R}^n \\
     y = h(x) & & h: \mathbb{R}^n \to \mathbb{R}^p
\end{array}
\end{equation}

Definition: 
\begin{itemize}
\item storage function $s: \mathbb{R}^n \to \mathbb{R}$, $x \to S(x)$ nonnegative (i.e., $s(x) \geq 0 \ \forall x \in \mathbb{R}^n$)
\item supply rate $s: \mathbb{R}^m \times \mathbb{R}^p \to \mathbb{R}$, $(u,y) \to s(u,y)$
\end{itemize}

Definition: System (\ref{input-output}) is dissipative w.r.t. the supply rate $s$ if there exists a storage function $S$ s.t. $\forall x_0 \in \mathbb{R}$, $\forall t \geq 0$, $\forall u : [0, t] \to \mathbb{R}^m$

\begin{equation*}
S(x(t)) \leq S(x_0)
 + \int_0^ts(u(\tau), y(\tau))d\tau
\end{equation*}  

First item - storage at time $t$, second item - initial storage,the last item - supply delivered over [0, $t$]

"dissipation inequality" (DIE)

Interpretation:
\begin{itemize}
\item "Dissipative systems dissipate storage/stored energy"
\item "No storage/energy can be created internally"
\item positive $s$ "supplied" energy/ storage
     
      negative $s$ "extracted" energy / storage
\end{itemize}

Remark: 
\begin{itemize}
\item If $S$ is differentiable, DIE is equivalent to $\dot{S}(x) \leq s(u,y) \ \forall u, x$
\item Dissipation (rate) is defined as $d(x,u) = s(u,h(x)) - \dot{S}(x) \geq 0$
\end{itemize}

Examples of dissipative systems:
\begin{center}
    \begin{tabular}{| l | l | l | l | l |}
    \hline
     & supply rate & input & output & storage function  \\ \hline
    electrical & $u \cdot i$ & voltage & current & energy storage in all capacitors and inductors\\ \hline
    mechanical & $F \cdot V$ & force & velocity & Hamiltonian = kinetic + potential energy \\ \hline
    thermo-dynamics & $Q + W$ & rate of hate & rate of work & internal energy \\
    \hline
    & $-\frac{a}{T}$ & & temperature & entropy \\
    \hline
    \end{tabular}
\end{center}

How do we computer storage functions?
\begin{itemize}
\item in general difficult (similar to computing Lyapunov functions)
\item characterization via optimization problem
\end{itemize}

Introduce "available storage"
\begin{equation*}
S_a(x) := sup_{u:[0,T] \to \mathbb{R}^m, T \geq 0, x(0) = 0} (- \int_0^Ts(u(\tau),y(\tau)))
\end{equation*}

the maximum of energy we can extract

\begin{Theorem}
System (\ref{input-output}) is dissipative w.r.t. the supply rate $s$ iff $S_a(x) < \infty$ for all $x \in \mathbb{R}^n$

Moreover, if $S_a(x) < \infty$ for all $x \in \mathbb{R}^n$, then $S_a$ is a storage function and $S(x) \geq S_a(x) \ \forall x \in \mathbb{R}^n$ for all storage functions $S$.

\begin{proof}
Sketch of proof. "$S_a(x) < \infty \Rightarrow$ dissipativity". $S_a(x) \geq 0 \ \forall x \in \mathbb{R}^n$ by definition (can take $T=0$)
\begin{equation*}
S_a(x) = sup_{u[0,T] \to \mathbb{R}^m, T \geq 0, x(0) = 0}- \int_0^Ts(u(\tau), y(\tau))d\tau \geq^* - \int_0^t s(u(\tau), y(\tau))d\tau + sup_{u[t,t+T] \to \mathbb{R}^m, T \geq 0, x(t) = x(t)} - \int_t^{t+T}s(u(\tau), y(\tau))d\tau
\end{equation*} 
the last item is $S_a(x(t))$, 
\begin{equation*}
\Rightarrow = S_a(x(t)) - \int_0^ts(u(\tau), y(\tau))d\tau
\end{equation*}
and this is DIE $\Rightarrow S_a$ is a storage function

Note for (*): "suboptimal" to first transfer system to $x(t)$ and then extract maximum energy starting of $x(t)$

"Dissip. $\Rightarrow S_a(x) < \infty$"

From DIE: $S(x_0) \geq S(x(T)) - \int_0^Ts(u(\tau), y(\tau))d\tau \geq - \int_0^T s(u(\tau),y(\tau))d\tau$

for all $x_0$, for all $T \geq 0$, all $u(\cdot) \Rightarrow S(x_0) \geq sup_{u:[0,T] \to \mathbb{R}^m, \ T \geq 0, \ x(0) = x_0} - \int_0^Ts(u(\tau),y(\tau))d\tau = S_a(x)$

$\Rightarrow S_a(x) < \infty \ \forall x \in \mathbb{R}^n$ and $S \geq S_a$ for all storage function $S$. 
\end{proof}
\end{Theorem}

Another special supply rate: "required supply"

\begin{equation*}
S_r(x) := inf_{u:[-T,0] \to \mathbb{R}^m, \ T \geq 0, \ x(-T) = x^*, \ x(0) = x} \int_T^0 s(u(\tau), y(\tau))d\tau
\end{equation*}

\begin{Theorem}
Assume that end state $x \in \mathbb{R}^n$ is readable from $x^*$. If system (\ref{input-output}) is dissipative w.r.t. the supply rate $s$, then for all storage functions $S$
\begin{equation*}
S(x) \leq S_r(x) + S(x^*) \ \forall \in \mathbb{R}^n
\end{equation*}
Furthermore, $S_r(x) + S(x^*)$ is a storage function.
\begin{proof}
Sketch of proof.

Consider $u:[-T,0] \to \mathbb{R}^n$ which transfers the system from $x^*$ to $x$
\begin{equation*}
S(x) - S(x^*) \leq[by DIE] inf_{u[-T,0] \to \mathbb{R}^n, \ T \geq 0, \ x(-T) = x^*, \ x(0) = x} \int_{-T}^0 s(u(\tau), y(\tau))d\tau = S_r(x)
\end{equation*}
\end{proof}
\end{Theorem}

Remark: Set of all storage functions is convex, i.e. , $\alpha S_1 + (1-\alpha) S_2$, $\alpha\in [0,1]$ is a storage function (for $S1, \ S2$ storage functions)